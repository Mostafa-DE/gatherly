# Repository Guidelines


## 1. Never Assume

If any requirement, behavior, naming, or constraint is unclear:
- STOP.
- Ask questions before writing code.
- Provide clear options with tradeoffs when applicable.

Do NOT guess defaults.
Do NOT infer intent.
Do NOT “fill the gaps” silently.

---

## 2. Small, Safe Changes

- Prefer small, incremental changes.
- Each change should keep the project buildable and runnable.
- Avoid large refactors unless explicitly requested.
- One concern per change.

---

## 3. Clarity Over Cleverness

- Prefer readable, boring, explicit code.
- Avoid over-engineering.
- Avoid unnecessary abstractions.
- Optimize for maintainability, not novelty.

---

## 4. Structure & Boundaries

- Keep clear separation of concerns.
- Avoid mixing unrelated responsibilities in the same module.
- Business logic must not live in UI layers.
- IO (network, DB, filesystem) should be isolated where possible.

---

## 5. Types & Validation

- TypeScript-first mindset.
- Strong typing at boundaries (inputs / outputs).
- Validate external input explicitly.
- Do not trust user input or external systems.

---

## 6. Data Integrity First

- Prefer enforcing invariants at the data layer when possible.
- Use transactions where consistency matters.
- Do not rely on frontend checks for correctness.

---

## 7. Naming & Consistency

- Use consistent terminology throughout the codebase.
- Do not introduce new terms without confirmation.
- Prefer explicit names over short or clever ones.

---

## 8. Testing Expectations

- Add tests for critical logic when feasible.
- If tests are skipped, explain why and suggest follow-up.
- Tests should reflect real use cases, not implementation details.

---

## 9. Refactoring Rules

- No refactoring unless:
  - It improves correctness, or
  - It is explicitly requested.
- Do not refactor “while you’re here”.
- Avoid touching unrelated code.

---

## 10. Agent Workflow (Required)

When working on any task:

1. Restate the goal briefly.
2. List questions if anything is unclear.
3. Propose a clear plan before implementing.
4. Implement in small steps.
5. Summarize:
   - What changed
   - How to run
   - How to verify
   - Known limitations or follow-ups

---

## 11. No `"use client"` / `"use server"` Directives

This project uses **TanStack Start + Nitro**, not Next.js. There are no React Server Components.
All components are client components by default. Do NOT add `"use client"` or `"use server"` to any file.

---

## 12. Default Behavior

- If unsure → ask.
- If ambiguous → ask.
- If risky → explain first.

---

## 13. Performance & Scalability First

- Always design database queries with performance and scalability in mind.
- Use proper indexes, avoid N+1 queries, prefer single aggregated queries over multiple round-trips.
- For analytics or aggregate queries, use SQL-level aggregation (`COUNT`, `SUM`, `AVG`, `GROUP BY`) — never fetch all rows and compute in application code.
- Consider query performance at scale (thousands of members, thousands of sessions) when writing data-access functions.
- Use `EXPLAIN ANALYZE` mentally — if a query would do a full table scan at scale, add an index or restructure.

---

## 14. Research Before Solving

- Before assuming a solution, use available tools to research first:
  - **Web search** for current best practices, library docs, and patterns.
  - **Context7** for up-to-date documentation of libraries used in the project.
  - **Available skills** (frontend-design, code-review, webapp-testing, etc.) to validate and improve solutions.
- Do not rely solely on training knowledge — verify against current docs and community patterns.

---

## 15. Design & UX Process

- For any new UI work, use sub-agents to help plan and design before implementing:
  - Explore existing UI patterns in the codebase for consistency.
  - Review the design system (`docs/DESIGN_SYSTEM.md`) for colors, typography, spacing, and component conventions.
  - Use the frontend-design skill for layout and visual decisions.
  - Ensure new UI aligns with the rest of the application in look, feel, and interaction patterns.
- Never build UI in isolation — always check how similar pages/components are built in the project first.

---

## 16. Auto-generated Files

Do NOT manually edit:
- `src/db/auth-schema.ts` — regenerate with `pnpm auth:generate`
- `src/routeTree.gen.ts` — auto-generated by TanStack Router

If you need to modify these, update the source config and regenerate.
